BAPP=4
ID=JTDX2
Name=JTDX2
Comment='WSJT DX Improved Project'
VerLocal=0
VerRemote=0
W3='https://sourceforge.net/projects/jtdx-improved/'
Author='spud'
NOTE='install from deb, had issues with compile'

INSTALL(){
    echo -e "INFORMATIONAL: apt-get required packages"
    sudo apt-get -y install libfftw3-dev >> errors/apt.log
    sudo apt-get -y install qtdeclarative5-dev >> errors/apt.log
    sudo apt-get -y install asciidoc >> errors/apt.log
    sudo apt-get -y install libqt5websockets5 >> errors/apt.log
    sudo apt-get -y install libqt5websockets5-dev >> errors/apt.log
    sudo apt-get -y install ntp >> errors/apt.log

    cd ${BAPSRC}
    sudo rm -rf jtdx2
    mkdir jtdx2
    cd jtdx2

    VER=$(curl --max-time 20 -s https://sourceforge.net/projects/jtdx-improved/files/ | grep '<tr title="jtdx_' | sed 's/<tr title="jtdx_//' | sed 's/" class="folder ">//')
    echo $VER > ${HOME}/.bap.jtdx.txt

    #wget -O jtdx2.zip https://sourceforge.net/projects/jtdx-improved/files/jtdx_$VER/Source%20code/jtdx_$VER_improved_source.zip/download
    #unzip jtdx2.zip
    #cd jtdx*
    #cd build
    #cmake -D CMAKE_PREFIX_PATH=~/hamlib-prefix ../
	#sudo cmake --build . --target install -j$BAPCORE
    #sudo make install/strip

    if [[ "$BAPCPU" == *"ar"* ]]; then
        
		#determine if pi-64 bit and install correct dependencies.
		if [ `getconf LONG_BIT` = '64' ]; then
            wget -O jtdx.deb https://sourceforge.net/projects/jtdx-improved/files/jtdx_$VER/Raspberry%20Pi/jtdx_$VER_improved_Rpi_arm64.deb/download
        else
            wget -O jtdx.deb https://sourceforge.net/projects/jtdx-improved/files/jtdx_$VER/Raspberry%20Pi/jtdx_$VER_improved_RPi_armhf.deb/download
        fi

    else
        wget -O jtdx.deb https://sourceforge.net/projects/jtdx-improved/files/jtdx_$VER/Linux/jtdx_$VER_improved_LINUX_amd64.deb/download
    fi
    
    sudo dpkg -i jtdx.deb

}

VERSION(){
    if [ -d ${HOME}/jtdx2 ];then
		if [ -f ${HOME}/.bap.jtdx2.txt ]; then
			CURRENT=$(cat ${HOME}/.bap.jtdx2.txt)
		else
        	CURRENT=UNKNOWN
		fi
    else
        CURRENT=NONE
    fi
    NEWVER=$(curl --max-time 20 -s https://sourceforge.net/projects/jtdx-improved/files/ | grep '<tr title="jtdx_' | sed 's/<tr title="jtdx_//' | sed 's/" class="folder ">//')
}

DEPENDS(){
    NEEDED='HAMLIB'

    #apt-gets will be checked on app-check
}
